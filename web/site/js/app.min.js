!function(e){var t=function(e){var t=this;t.name="ControllerNotFoundException",t.message='Controller "'+e+'" not registered'};t.prototype=Object.create(Error.prototype);var n=function(){this._controllers={}};n.prototype.create=function(e,n,r){var o=this._controllers[n];if(!o)throw new t(n);return e.controller=new o(e,r)},n.prototype.register=function(e,t){this._controllers[e]=t};var r=function(e){var t=function(e){if(e&&e.children){var n,r,o=e.children.length;for(n=0;o>n;n++)r=e.children[n],t(r)}e.controller&&(e.controller.teardown&&e.controller.teardown(),delete e.controller)};if("DOMNodeRemoved"==e.type){var n=e.target;t(n)}};document.body.addEventListener("DOMNodeRemoved",r,!0);var o=e.controllers=o||new n}(this),function(e){var t,n=0,r=e.handlebarsHelpers={JSONstringify:function(e){return JSON.stringify(e,null,"  ")},limit:function(e,t,n){if(!e||0==e.length)return n.inverse(this);for(var r=[],o=0;t>o&&o<e.length;++o)r.push(n.fn(e[o]));return r.join("")},isComplex:function(e){return"object"==typeof e?!0:!1},ifComplex:function(e,t){return"object"==typeof e?t.fn(this):t.inverse(this)},notPrivate:function(e,t){var n,r={};for(n in e)"_"!==n.substr(0,1)&&(r[n]=e[n]);return t.fn(r)},keys:function(e,t){return t.fn(Object.keys(e))},eachKeys:function(e,t){var n=Object.keys(e||{}),r="";return n.forEach(function(n){r+=t.fn({key:n,value:e[n]})}),r},getval:function(e,t,n){return e[t]||n||""},properCase:function(e){var t=(e||"").replace(/([A-Z])/g," $1"),n=t.charAt(0).toUpperCase()+t.slice(1);return n},embed:function(e,t){var r="component_"+n++,o=el("#"+e).getAttribute("data-controller");if(o){var i='<div id="'+r+'"></div>';setTimeout(function(t,n,r){return function(){var o=el("#"+t);controllers.create(o,n,{data:r,template:el("#"+e).innerHTML})}}(r,o,t),10)}else i=template(t,{helpers:handlebarsHelpers});return new Handlebars.SafeString(i)},qrcode:function(e,t){var r="component_"+n++;return setTimeout(function(n){return function(){var r=new QRCode(n,{width:t,height:t});r.makeCode(e)}}(r),10),new Handlebars.SafeString('<div id="'+r+'"></div>')},log:function(e){console.log(e)},moment:function(e,t){return moment(e).format(t)}};for(t in Handlebars.helpers)r[t]=r[t]||Handlebars.helpers[t]}(this),{define:"undefined"!=typeof define?define:function(e,t){"undefined"!=typeof module?module.exports=t():window.Loader=t()}}.define([],function(){var e={},t=[],n=[];e.dataTypes={json:"application/json",jsonp:"application/json"};var r=function(e,r){var o=t.indexOf(e),i=o>-1;return i||(o=t.length,t[o]=e,n[o]=[]),n[o].push(r),i},o=function(e,r,o){var i,a,s,l=t.indexOf(e);if(l>-1)for(i=(n.splice(l,1)||[])[0]||[],t.splice(l,1),s=i.length,a=0;s>a;a++)i[a](r,o)},i=function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(window.ActiveXObject)for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}else if(window.XMLHttpRequest)return new XMLHttpRequest;return!1},a=function(e){var t,n,r,o=[],i=function(e,t){t=t instanceof Function?t():null===t?"":t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(e instanceof Array)for(r=e.length,n=0;r>n;n++)i(e[n].name,e[n].value);else if(e)for(t in e)i(t,e[t]);return o.join("&").replace(/%20/g,"+")},s=function(t){e[t]=function(n,s,l){var c,u,f,p,d,h,v=n;if("function"==typeof s&&(l=s,s={}),l=l||function(){},s=s||{},"string"==typeof s.uri)try{s.uri=JSON.parse(s.uri)}catch(y){}if(s.uri=s.uri||{},c=n+JSON.stringify(s.uri)+JSON.stringify(s.data),!r(c,l))if(s.uri.ts=new Date,v+=(-1===(v||"").indexOf("?")?"?":"&")+a(s.uri),u=new i,u.onreadystatechange=function(){if(4===u.readyState)if(200===u.status||-1===window.location.href.indexOf("http")){try{f=JSON.parse(u.responseText)}catch(e){f=u.responseText}if(f.error||f.errors)o(c,f);else{p=f[f.root];try{f=p instanceof Array?{items:p,offset:f.offset,limit:f.limit,count:f.count,length:p.length}:p||f}catch(e){}o(c,null,f)}}else{var t=new Error(u.statusText+": "+(u.responseText||u.response));t.type=u.statusText,t.code=u.status,t.requestObject=u,o(c,t)}},u.open(t.toUpperCase(),v,!0),s.data){if(h=e.dataTypes[s.dataType]||s.dataType||"application/json",s.data instanceof FormData)d=s.data;else{u.setRequestHeader("Content-type",h);try{d=JSON.stringify(s.data)}catch(y){d=s.body}}s.headers&&!function(){var e;for(e in s.headers)try{u.setRequestHeader(e,s.headers[e])}catch(t){}}(),u.send(d)}else u.send(null)}};return e.postForm=function(e,t){var n=new FormData(e),a=e.action+(new Date).getTime();if(!r(a,t)){var s=new i;s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||-1===window.location.href.indexOf("http")){try{response=JSON.parse(s.responseText)}catch(e){response=s.responseText}if(response.error||response.errors)o(a,response);else{items=response[response.root];try{response=items instanceof Array?{items:items,offset:response.offset,limit:response.limit,count:response.count,length:items.length}:items||response}catch(e){}o(a,null,response)}}else{var t=new Error(s.statusText+": "+(s.responseText||s.response));t.type=s.statusText,t.code=s.status,t.requestObject=s,o(a,t)}},s.open("POST",e.action,!0),s.send(n)}return!1},function(e,t){var n,r=e.length;for(n=0;r>n;n++)t(e[n])}(["get","post","put","delete"],s),e}),function(e){var t=e.Partials=function(e){var t=this;t.options=e,t.options.ext=t.options.ext||".html",t.options.path=t.options.path||"/partials/"};t.prototype.set=function(e,t){var n=el("#"+e);n||(n=document.createElement("script"),n.setAttribute("type","text/x-template"),n.setAttribute("id",e),document.getElementsByTagName("head").item(0).appendChild(n)),n.innerHTML=t,Handlebars.registerPartial(e,Handlebars.compile(t))},t.prototype.get=function(e,t){var n=this,r=el("#"+e);if(r||(r=document.createElement("script"),r.setAttribute("type","text/x-template"),r.setAttribute("id",e),document.getElementsByTagName("head").item(0).appendChild(r)),r.innerHTML)try{Handlebars.partials[e]||n.set(e,r.innerHTML),t(null,Handlebars.partials[e])}catch(o){t(o,Handlebars.partials[e])}else Loader.get(n.options.path+e+n.options.ext,function(o,i){if(o)return t(o);r.innerHTML=i;try{n.set(e,r.innerHTML),t(null,Handlebars.partials[e])}catch(a){t(a,Handlebars.partials[e])}})},t.prototype.preload=function(e){var t=this,n=1,r=function(){n--,1>n&&setTimeout(e,1)};els('[type="text/x-template"]').forEach(function(e){var o=e.getAttribute("id");n++,t.get(o,r)}),r()}}(this);var Record=function(e){{var t=this;t.keys=new Array}t._listeners={},t._data=e};Record.prototype.on=function(e,t){self._listeners[e]=self._listeners[e]||[],self._listeners[e].push(t)},Record.prototype.off=function(e,t){var n=!1;if(self._listeners[e]instanceof Array)if(t){var r,o=self._listeners[e].length;for(r=o;r>-1;--r)self._listeners[e][r]===t&&(self._listeners[e].splice(r,1),n=!0)}else delete self._listeners[e],self._listeners[e]=!1,n=!0;return n},Record.prototype.handle=function(e,t){var n,r=this,o=r._listeners[e]||[],i=o.length;for(n=0;i>n;n++)o[n].call(r,t)},Record.prototype.raw=function(){var e=this;return e._data},Record.prototype.get=function(e){var t=this;return t._data[e]},Record.prototype.set=function(e,t){var n=this;return n._data[e]=t,n.handle("updated",e),t},Record.prototype.remove=function(e){var t=this;return delete t._data[e],t.handle("removed",e),value},Record.prototype.update=function(e){var t,n=this;for(t in e)n._data[t]=e[t];n.handle("updated")},Record.prototype.toString=function(){var e=this;return JSON.stringify(e._data)};var Store=function(e){var t=this;t.records=new Array,t._updates=0,t._listeners={},t.options=e||{}};Store.prototype.on=function(e,t){self._listeners[e]=self._listeners[e]||[],self._listeners[e].push(t)},Store.prototype.off=function(e,t){var n=!1;if(self._listeners[e]instanceof Array)if(t){var r,o=self._listeners[e].length;for(r=o;r>-1;--r)self._listeners[e][r]===t&&(self._listeners[e].splice(r,1),n=!0)}else delete self._listeners[e],self._listeners[e]=!1,n=!0;return n},Store.prototype.handle=function(e,t){var n,r=this,o=r._listeners[e]||[],i=o.length;for(n=0;i>n;n++)o[n].call(r,t)},Store.prototype.beginUpdate=function(){var e=this;e._updates++},Store.prototype.endUpdate=function(){var e=this;e._updates&&(e._updates--,0==e._updates&&e.handle("updated"))},Store.prototype.insert=function(e){var t=this,n=new Record(e);t.records.push(n),t.handle("inserted",n)},Store.prototype.find=function(e){var t=this;return sift(e,t.records)},Store.prototype.get=function(e){var t=this,n=t.find({_id:e});return n.length?n[0]:!1},Store.prototype.update=function(e,t){var n=this;return void 0===t&&(e=t._id||t.name),t._id=e||t._id||t.name,(record=n.get(e))?(record.update(t),!0):!1},Store.prototype.upsert=function(e){var t=this;return t.update(e._id,e)||t.insert(e),t},function(e){e.el=function(e,t){return t||(t=e,e=document),e.querySelector(t)},e.els=function(e,t){return t||(t=e,e=document),Array.prototype.slice.call(e.querySelectorAll(t))},e.val=function(e){return e.value||e.getAttribute("value")||e.innerText||e.innerHTML},e.pkg=function(e){var t={};return e.forEach(function(e){t[e.getAttribute("name")]=val(e)}),t}}(this);var SampleController=function(e){e.innerHTML=e.dataset.content};controllers.register("SampleController",SampleController),function(e){var t=(window.socket=io(),e.partials=new Partials({path:"partials/",ext:".html"})),n=e.Application=function(){var e=this;t.preload(function(){e.init()})};n.prototype.displayPage=function(e,n){var r=e.split("/"),o=r.shift();t.get(e,function(t,r){if(t){var i=new Error(e+": "+t);throw i.page=e,i.source=r,i}try{var a=el("#outlet"),s=el("#"+e).getAttribute("data-controller");o=el("index"===o?'nav li a[href="#home"]':'nav li a[href="#'+(o||"home")+'"]'),a.innerHTML=r(n||{},{helpers:handlebarsHelpers}),s&&controllers.create(a,s,n);var l,c,u=els(a,"[data-controller]"),f=u.length;for(c=0;f>c;c++)l=u[c],s=l.getAttribute("data-controller"),controllers.create(l,s,n)}catch(p){throw p}})},n.prototype.init=function(){var e=this,t=Satnav({html5:!1,force:!0,poll:100});t.navigate({path:"/",directions:function(){e.displayPage("home")}});for(var n=els("script[nav]"),r=0,o=n.length;o>r;r++)t=t.navigate(function(t,n,r){return{path:n,directions:r?function(n){var o=r.replace(/{([^}]+)}/g,function(e,t){return n[t]});Loader.get(o,function(n,r){e.displayPage(t,n||r)})}:function(){e.displayPage(t)}}}(n[r].getAttribute("id"),n[r].getAttribute("nav"),n[r].getAttribute("data-api")));t.change(function(){return e.displayPage("loading"),t.resolve(),this.defer}).otherwise("/"),t.go()};e.app=new n}(this);